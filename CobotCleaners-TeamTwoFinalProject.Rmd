---
title: "ETM 640 Team 2 Final Project"
author: "Team 2"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library (magrittr, quietly = TRUE) #Used for pipes/dplyr
library (dplyr, quietly = TRUE)
library (ROI, quietly = TRUE)
library (ROI.plugin.glpk, quietly = TRUE)
library (ompr, quietly = TRUE)
library (ompr.roi, quietly = TRUE)
library (pander, quietly = TRUE)
```

## Team Members

- Christopher Davis
- Brandon Iwasaki
- Taban Yolo
- Niss Lagah

## Final Paper

[Click here](https://docs.google.com/document/d/14RsYIWRkcGrVW3ZvBQ0Zhixd4qoAOTht5TTymMF9xBg/edit) to check out our final paper.

Code for this project is in [GitHub](https://github.com/cwhd/cobot-operations)

## Abstract

Robots are becoming cheaper to build and cobotics (collaborative robotics) are creating new business opportunities. The home cleaning market is projected to reach $33 billion b 2022 [1](https://www.zionmarketresearch.com/news/household-cleaners-market) and is an ideal scenario for cobot cleaning services. This paper explores the opportunity from an operations research perspective to determine the ideal configurataion to determine how to package robots together for maximum profitibility, explore which types of robots to invest in based on tarket markets, and the best way to transport them around.

## Scenarios

### Scenario 1

A certain configuration of robot is used to clean a certain type of space. For example a house with more bathrooms requires more sink cleaners, a house with carpet needs a special vaccum. We have broken down the configuration needed for each space type into different cleaning packages, where a package represents a certain configuration of robots.

The following data represents our 6 packages available and the robots within them. Note that we already have an idea of how much profit we can make from each package.

Robot Information:
 - Robot 1 is the standard vaccum, used for hardwood floors
 - Robot 2 is the carpet vaccum, not needed if there is no carpet
 - Robot 3 is the sink cleaner, we need more for more bathrooms
 - Robot 4 is the duster drone, we need more for bigger spaces
 - Robot 5 is the window cleaner, we need more for more winds, generally bigger spaces

Package Information:
 - Package 1 covers a 1 bathroom apartment or house, <= 1400 square feet with no carpet
 - Package 2 covers a 1 bathroom apt or house, <= 1400 sq ft with carpet
 - Package 3 no carpet, 1 bathroom
 - Package 4 2 bath, carpet, <= 2300 sq ft
 - Package 5 all carpet 2 bath <= 2000 sq ft
 - Package 6 carpet, 2-3 bath, <= 2000 sq ft


Here is dataa from the CSV files:

```{r}
robotData<-read.csv(file="RobotData.csv") #load the data
packageData<-read.csv(file="packageConfigs.csv") #load the data

pander (robotData, caption="Robot Data")
pander (packageData, caption="Package Data")
```

Here is the code and the model with hardcoded data. Ideally we should tweak this so that we're using the data from the CSV files above.

```{r}
NProd <- 6
NResources <- 5

#this represents the list of packages
ProdNames <- lapply(list(rep("Package-",NProd)),paste0,1:NProd) 
                 # Product names: Package-1, Package-2, etc. 

#this represents the robots used in each package configuration
ResNames<- lapply(list(rep("Robot-",NResources)),paste0,1:NResources) 
                 # Resource names: Robot-1, Robot-2, etc.

#each package has it's own profit amount
Profit <- matrix(c(20, 16, 18, 16, 19, 20), 
              ncol=NProd,dimnames=c("Profit",ProdNames))


#this represents how many of each robot is used in each package
Resources <- matrix(c( 1,0,2,2,4,
                       1,1,2,2,4,
                       1,0,1,2,4,
                       2,2,3,3,5,
                       0,2,2,3,3,
                       1,2,3,4,3), 
              ncol=NProd,dimnames=c(ResNames,ProdNames))

#this represents the number of robots we have available of each type
Available <- matrix(c(25, 35, 40, 20,25), 
              ncol=1,dimnames=c(ResNames,"Available"))

#here are the variables from the file but they don't work in the formula below for some reason. I think they're in the wrong format...
#Resources <- as.matrix(packageData[1:5,])
#Available <- robotData[,c(1,4)]
#Profit <- packageData[6,]

#NProd <- ncol(Resources)
#NResources <- nrow(robotData)

DisplayResources <- rbind(Resources, Profit)
pander(DisplayResources, caption="Resources used by each product")
pander (Available, caption="Amount of each Resource Available")

```

- We have 6 packages, we need to determine which is most profitable

To do this we will set the profitibility of each package, and which robots are in each package. 
maximize profit
decision variables: 6 packages
constraints: number of each type of robot


Now that everything is set up, run the model

```{r}

prodmodel <- MIPModel() %>%
  add_variable (x[i], i=1:NProd, type="continuous", lb=0) %>%
  set_objective (sum_expr(Profit[i] * x[i] , i=1:NProd ), "max") %>%
  add_constraint (sum_expr(Resources[j,i]*x[i], i=1:NProd) # Left hand side of constraint
                  <= Available[j],    # Inequality and Right side of constraint
                  j=1:NResources) %>% # Repeat for each resource, j.  
  solve_model(with_ROI(solver = "glpk"))
  
prodmodel
results.products <- matrix (rep(-1.0,NProd), nrow = NProd, ncol=1,
                            dimnames=c(ProdNames,c("x")))

temp <- get_solution (prodmodel, x[i]) # Extracts optimal values of variables   
results.products <- t(temp [,3] )      # Extracts third column

results.products <- matrix (results.products, nrow = 1, ncol=NProd,
                            dimnames=c(c("x"),ProdNames))  
                                       # Resizes and renames 

pander (results.products, caption = "Optimal Production Plan")

```


## Scenario 2

- Use sensitivity analysis to determine where to invest next

from the first scenario we should know what relative profitability is for each robot. We can then look at the shadow pricing (from week 3) to determine which robots are contributing the most to profitibility and therefore where to invest to grow the company.

For this we need to know the cost of each robot, that way we can determine based on the profitibility of each package, which robots do we need to deliver more of our most profitable packages? This will also help us determine which neighborhoods to target for marketing.

We can find shadow pricing with RDuals:

```{r rduals_3var}
rduals1 <-as.matrix(get_row_duals(prodmodel))
dimnames(rduals1)<-list(c("Robot 1", "Robot 2", "Robot 3", "Robot 4", "Robot 5"), c("Row Duals"))
pander(rduals1,caption="Shadow Prices of Constrained Resources")
```

I think this means Robots 4 and 5 are our primary constrainted resources and we should invest in them to make more $. This model still needs a bit more work. We need to test our hypothesis to see how much more money we can make by buying additional robots. It could also be interesting to use a fixed cost analysis to figure out how many new customers we would need to justify the investment.

## Scenario 3

- Finally we will do the transportation problem so that we can determine which van to send to which neighborhood


We would like to determine which cobots to invest in to maximize growth while minimizing overhead. Their target market includes houses in planned neighborhoods and apartments with known configurations, so we should be able to project which cobots need to be built or configured to meet an estimated demand. Ideally we would like to find apartment complexes or neighborhoods that we can work in where we can optimize our investments, finding the ideal number of robots based on real estate data should help us do this.



[FOR NOW IGNORE EVERYTHING BELOW THE LINE]

### Location Data

Here is data from Zillow with location information:

```{r}
customerLocationData<-read.csv(file="CustomerLocationData.csv") #load the data
print(paste0(nrow(customerLocationData), " rows"))
print(paste0(ncol(customerLocationData), " columns"))
pander (customerLocationData, caption="Customer Location Data")

```



